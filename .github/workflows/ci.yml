name: Python Selenium CI avec rapport HTML

# DÃ©clencheurs du workflow : sur chaque push ou pull request vers "main"
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  run-tests:
    # Lancer le job sur une VM Ubuntu 
    #runs-on: ubuntu-latest
    runs-on: windows-latest

    steps:
    # Ã‰tape 1 : Cloner le code source du repo
    - name: ğŸ“¥ Cloner le code
      uses: actions/checkout@v4

    # Ã‰tape 2 : Installer la version de Python souhaitÃ©e (ici 3.12)
    - name: ğŸ Installer Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    # Ã‰tape 3 : Installer les dÃ©pendances Python + junit2html
    - name: ğŸ“¦ Installer les dÃ©pendances
      run: |
        # Mettre Ã  jour pip
        python -m pip install --upgrade pip
        # Installer les dÃ©pendances de ton projet dÃ©finies dans requirements.txt
        pip install -r requirements.txt
        # Installer lâ€™outil Python junit2html pour convertir XML â†’ HTML
        pip install junit2html

    # Ã‰tape 4 : ExÃ©cuter les tests Behave avec gÃ©nÃ©ration de rapports au format JUnit XML
    - name: ğŸ§ª ExÃ©cuter les tests Behave (avec JUnit XML)
      run: behave --junit --junit-directory reports/xml

    # Ã‰tape 5 : Convertir le fichier XML gÃ©nÃ©rÃ© en rapport HTML lisible
    - name: ğŸ”„ Convertir XML en HTML avec junit2html
      run: |
        # CrÃ©er le dossier de sortie (au cas oÃ¹ il nâ€™existe pas)
        mkdir -p reports/html
        # Conversion : XML â†’ HTML
        junit2html reports/xml/TESTS-Creation-De-Compte.xml reports/html/report.html
        # VÃ©rifier que le fichier a bien Ã©tÃ© gÃ©nÃ©rÃ©
        ls -R reports/html

    # Ã‰tape 6 : Sauvegarder le rapport HTML comme artefact tÃ©lÃ©chargeable
    - name: ğŸ“ Sauvegarder le rapport HTML
      uses: actions/upload-artifact@v4
      with:
        # Nom que tu verras dans GitHub Actions (Artifacts)
        name: rapport-behave-html
        # Chemin vers le dossier contenant le rapport HTML
        path: reports/html
